<!DOCTYPE html>
<html>
<head>
    <title>SignalR Simple Chat</title>
    <style type="text/css">
        *{ padding: 0;margin: 0;}
         body {position: relative;font-size: 12px;}
        html, body {min-height: 100%;}
        #img {position: absolute;top: 0;left: 0;width: 100%;height: 100%; z-index: 100}
        #retry{ position: absolute;z-index: 200}
    </style>
</head>
<body>
    <div id="img"></div>

    <!--Reference the jQuery library. -->
    <script src="Scripts/jquery-1.6.4.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="Scripts/jquery.signalR-2.0.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <!--<script id="jshub" src="http://192.168.1.66:8080/signalr/hubs"></script>-->
    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">
        var url = "";
        do {
            url = prompt('输入按如下格式输入目标服务器IP地址:\nhttp://192.168.1.66:8080', 'http://192.168.1.66:8080');
            if (url == null) {
                //Reference the autogenerated SignalR hub script.
                document.write("User Canceled, <a id='retry' href='javascript:location.href=location.href;'>Retry</a>");
                break;
            }
        } while (!/^http:\/\/192\.168\.1\.\d{1,3}\:\d{2,5}$/.test(url));
        if (url != null) {
            document.write("<script src='" + url + "/signalr/hubs'><\/script>");

            $(function () {

                //Set the hubs URL for the connection
                $.connection.hub.url = url + "/signalr";

                // Declare a proxy to reference the hub.
                var chat = $.connection.myHub;

                // Create a function that the hub can call to broadcast messages.
                chat.client.stream = function (img) {
                    var cont = $("#img"),
                        el = $("img", cont);
                    if (el.length == 0) el = $("<img/>").appendTo(cont);
                    el.attr("src", "data:image/png;base64," + img);
                };
                // Start the connection.
                $.connection.hub.start().done(function () {

                });
            });
        }
    </script>
</body>
</html>